<!DOCTYPE html>
<html>
	<head>
		<title>Github as Blog CMS Tutorial</title>
		<script type="module">
			import {React, ReactDOM} from 'https://unpkg.com/es-react@16.13.1'
			import htm from 'https://unpkg.com/htm?module'
			import { endpoint } from 'https://cdn.skypack.dev/@octokit/endpoint'
			import marked from 'https://unpkg.com/marked@2.0.0/lib/marked.esm.js'
			const TOKEN = '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'
			const html = htm.bind(React.createElement)
			const Posts = (props) => {
				const [issues, setIssues] = React.useState([])
				 React.useEffect(() => {
           async function fetchIssues() {
					 		const { url, ...options} = 
								endpoint('GET /repos/:owner/:repo/issues', {
								         owner: 'rickbsgu',
												 repo: 'github-as-blog-cms',
												 auth: TOKEN,
					   })
					   const reponse = await fetch(url, options)
					   const issues = await reponse.json()
					   setIssues(issues)
					 }

					 fetchIssues()
				}, [])
				const {search} = window.location
				return html`
				  ${issues
						.filter(({number}) => !search || Number(search.slice(1)) === number)
						.map(({number, title, body}) => {
						return html`
							<div id=${number} key=${number}>
								<h1><a href="?${number}"> ${title}</a></h1>
								<div dangerouslySetInnerHTML="${{__html: marked(body)}}"></div>
							</div>
				`
			  })}
			`
			}

			ReactDOM.render(html`<${Posts} />`, document.body)
		</script>
	</head>
	<body>
		Some other content
	</body>
</html>
